# Available Methods

| Method | Result | Description |
| - | - | - |
`initConnection()` | `Promise<boolean>` | Init IAP module. On Android this can be called to preload the connection to Play Services. On iOS, it will simply call `canMakePayments` method and return value which is required for the listeners to work properly.
`purchaseUpdatedListener((purchase: ProductPurchase) => {})` | `EmitterSubscription` | Register a callback that gets called when the store has any updates to purchases that have not yet been finished, consumed or acknowledged. Returns a React Native `EmitterSubscription` on which you can call `.remove()` to stop receiving updates. Register you listener as soon as possible and react to updates at all times.   
`purchaseErrorListener((error: PurchaseError) => {})` | `EmitterSubscription` | Register a callback that gets called when there has been an error with a purchase. Returns a React Native `EmitterSubscription` on which you can call `.remove()` to stop receiving updates.
`getProducts(skus: string[])`<ul><li>skus: array of Product ID/sku</li></ul>           | `Promise<Product[]>`      | Get a list of products (consumable and non-consumable items, but not subscriptions). Note: With before `iOS 11.2`, this method _will_ also return subscriptions if they are included in your list of SKUs. This is because we cannot differentiate between IAP products and subscriptions prior to `iOS 11.2`.
`getSubscriptions(skus: string[])`<ul><li>skus: array of Subscription ID/sku</li></ul> | `Promise<Subscription[]>` | Get a list of subscriptions. Note: With before `iOS 11.2`, this method _will_ also return products if they are included in your list of SKUs. This is because we cannot differentiate between IAP products and subscriptions prior to `iOS 11.2`.
`getPurchaseHistory()` | `Promise<Purchase>`       | Gets an inventory of purchases made by the user regardless of consumption status (where possible).
`getAvailablePurchases()` | `Promise<Purchase[]>`     | Get all purchases made by the user (either non-consumable, or haven't been consumed yet). On Android, it can be called at app launch, but on iOS, only at restoring purchase is recommended (See: [#747](https://github.com/dooboolab/react-native-iap/issues/747)).
`requestPurchase(sku: string, andDangerouslyFinishTransactionAutomatically: boolean, obfuscatedAccountIdAndroid: string, obfuscatedProfileIdAndroid: string)`<ul></ul>                    | `Promise<ProductPurchase>`       | Request a purchase. `purchaseUpdatedListener` will receive the result.<br/> `andDangerouslyFinishTransactionAutomatically` defaults to `true` for backwards compatibility but this is deprecated and you should set it to false once you're [manually finishing your transactions](../usage_instructions/purchase).
`requestPurchaseWithQuantityIOS(sku: string, quantity: number)`<ul><li>sku: product ID/sku</li><li>quantity: Quantity</li></ul>                 | `void` | **iOS only** Buy a product with a specified quantity. `purchaseUpdatedListener` will receive the result
_*deprecated_ ~~`buySubscription(sku: string)`~~<ul><li>sku: subscription ID/sku</li></ul> | `void` | Create (buy) a subscription to a sku.
`requestSubscription(sku: string, andDangerouslyFinishTransactionAutomaticallyIOS: boolean, oldSkuAndroid: string, purchaseTokenAndroid: string, prorationModeAndroid: ProrationModesAndroid, obfuscatedAccountIdAndroid: string, obfuscatedProfileIdAndroid: string)`<ul><li>sku: subscription ID/sku</li><li>prorationModeAndroid: one of undefined, UNKNOWN_SUBSCRIPTION_UPGRADE_DOWNGRADE_POLICY, IMMEDIATE_WITH_TIME_PRORATION, IMMEDIATE_AND_CHARGE_PRORATED_PRICE, IMMEDIATE_WITHOUT_PRORATION, DEFERRED</li></ul>                  | `Promise<SubscriptionPurchase | null>` | Create (buy) a subscription to a sku. **Note:** Promise resolves to null when using proratioModesAndroid=DEFERRED, and to a SubscriptionPurchase otherwise
`clearTransactionIOS()` | `void`            | **iOS only** Clear up unfinished transanctions which sometimes cause problems. Read more in [#257](https://github.com/dooboolab/react-native-iap/issues/257), [#801](https://github.com/dooboolab/react-native-iap/issues/801).
`clearProductsIOS()`    | `void`            | **iOS only** Clear all products and subscriptions. Read more in below README.
`getReceiptIOS()`   | `Promise<string>` | **iOS only** Get the current receipt.
`getPendingPurchasesIOS()` | `Promise<ProductPurchase[]>` | **IOS only** Gets all the transactions which are pending to be finished.
`validateReceiptIos(body: Record<string, unknown>, devMode: boolean)`<ul><li>body: receiptBody</li><li>devMode: isTest</li></ul> | `Object\|boolean` | **iOS only** Validate receipt.
`presentCodeRedemptionSheetIOS()` | `Promise<null>` | **iOS only** Availability: `iOS 14.0+` Displays a sheet that enables users to redeem subscription offer codes that you generated in App Store Connect.
`endConnection()` | `Promise<void>` | End billing connection.
`consumeAllItemsAndroid()` | `Promise<void>` | **Android only** Consume all items so they are able to buy again. ⚠️ Use in dev only (as you should deliver the purchased feature BEFORE consuming it)
`flushFailedPurchasesCachedAsPendingAndroid()` | `Promise<void>` | **Android only** Consume all 'ghost' purchases (that is, pending payment that already failed but is still marked as pending in Play Store cache)
`consumePurchaseAndroid(token: string, payload?: string)`<ul><li>token: purchase token</li><li>payload: developerPayload</li></ul>     | `void` | **Android only** Finish a purchase. All purchases should be finished once you have delivered the purchased items. E.g. by recording the purchase in your database or on your server.
`acknowledgePurchaseAndroid(token: string, payload?: string)`<ul><li>token: purchase token</li><li>payload: developerPayload</li></ul> | `Promise<PurchaseResult>` | **Android only** Acknowledge a product. Like above for non-consumables. Use `finishTransaction` instead for both platforms since version 4.1.0 or later.
`consumePurchaseAndroid(token: string, payload?: string)`<ul><li>token: purchase token</li><li>payload: developerPayload</li></ul>     | `Promise<PurchaseResult>` | **Android only** Consume a product. Like above for consumables. Use `finishTransaction` instead for both platforms since version 4.1.0 or later.
`finishTransactionIOS(transactionId: string)`<ul><li>transactionId: the transactionId that you would like to finish.</li></ul> | `Promise<void>` | **iOS only** Finish a transaction. Use `finishTransaction` instead for both platforms since version 4.1.0 or later.
`finishTransaction(purchase: InAppPurchase/ProductPurchase, isConsumable?: boolean, developerPayloadAndroid?: string)`<ul><li>purchase: purchase object</li><li>isConsumable?: specify whether the product is a consumable</li><li>developerPayloadAndroid: developerPayload</li></ul> | `Promise<void>` | This method works for both platforms and is recommended since version 4.1.0 or later. Equal to `finishTransactionIOS` + `consumePurchaseAndroid` and `acknowledgePurchaseAndroid`.
_*deprecated_ ~~`buySubscription(sku: string, prevSku?: string, mode?: number)`~~<ul><li>sku: subscription ID/sku</li><li>prevSku: old subscription ID/sku (optional)</li><li>mode: proration mode (optional)</li></ul> | `Promise<Purchase>` | **Android only** Create (buy) a subscription to a sku. For upgrading/downgrading subscription on Android pass the second parameter with current subscription ID, on iOS this is handled automatically by store. You can also optionally pass in a proration mode integer for upgrading/downgrading subscriptions on Android
`validateReceiptAndroid(bundleId: string, productId: string, productToken: string, accessToken: string)` <ul><li>bundleId: the packageName</li><li>productId: productId</li><li>productToken: productToken</li><li>accessToken: accessToken</li><li>isSubscription: isSubscription</li></ul> | `Object\|boolean` | **Android only** Validate receipt.
`deepLinkToSubscriptionsAndroid(sku: string)` <ul><li>sku: subscription sku</li> | `void` | **Android only** Deep link user into Google Play's subscriptions screen.
`validateReceiptAmazon(developerSecret: string, userId: string, receiptId: string, useSandbox : boolean)` <ul><li>developerSecret: from the Amazon developer console</li><li>userId: who purchased the item</li><li>receiptId: long obfuscated string returned when purchasing the item</li><li>useSandbox: Defaults to true, use sandbox environment or production.</li></ul> | `Object\|boolean` | **Amazon only** Validate receipt.
_*deprecated_ ~~`setInstallSourceAndroid()`~~ | `void` | **Android only** It was used to select the Android Module (Amazon or Google Play) This is now handled by the variant selected when running the app. This method will be removed as there's no use for it anymore
`getPromotedProductIOS()` | `Promise<Product | null>` | **IOS only** Returns the productId of the promoted product. Indicates the the App Store purchase should continue from the app instead of the App Store.
