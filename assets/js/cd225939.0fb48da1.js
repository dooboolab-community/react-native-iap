"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7792],{5680:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>m});var a=n(6540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),g=i,m=u["".concat(s,".").concat(g)]||u[g]||c[g]||r;return n?a.createElement(m,o(o({ref:t},d),{},{components:n})):a.createElement(m,o({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=g;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},8663:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(6540);function i(e){let{className:t="adfit",style:n,unit:i,height:r,width:o}=e;return(0,a.useEffect)((()=>{let e=document.createElement("ins"),n=document.createElement("script");e.className="kakao_ad_area",e.style="display:none; width:100%;",n.async="true",n.type="text/javascript",n.src="//t1.daumcdn.net/kas/static/ba.min.js",e.setAttribute("data-ad-width",o.toString()),e.setAttribute("data-ad-height",r.toString()),e.setAttribute("data-ad-unit",i.toString()),document.querySelector(`.${t}`).appendChild(e),document.querySelector(`.${t}`).appendChild(n)}),[]),a.createElement("div",{style:n},a.createElement("div",{className:t}))}},1748:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(6540),i=n(8663);function r(){return a.createElement(i.A,{unit:"DAN-YTmjDwlbcP42HBg6",height:100,width:320,className:"adfit-top",style:{flex:1,marginTop:24,marginBottom:24}})}},6224:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(8168),i=(n(6540),n(5680)),r=n(1748);const o={title:"Migrating to 11.0.0",sidebar_label:"Migrating to 11.0.0"},l=void 0,s={unversionedId:"migrate_to_11.0.0",id:"migrate_to_11.0.0",title:"Migrating to 11.0.0",description:"Version 11.0.0 is centered around implementing iOS Storekit 2.",source:"@site/docs/migrate_to_11.0.0.mdx",sourceDirName:".",slug:"/migrate_to_11.0.0",permalink:"/docs/migrate_to_11.0.0",draft:!1,editUrl:"https://github.com/dooboolab-community/react-native-iap/edit/main/docs/docs/migrate_to_11.0.0.mdx",tags:[],version:"current",frontMatter:{title:"Migrating to 11.0.0",sidebar_label:"Migrating to 11.0.0"},sidebar:"tutorialSidebar",previous:{title:"Migrating to 10.0.0",permalink:"/docs/migrate_to_10.0.0"},next:{title:"Migrating to 12.0.0",permalink:"/docs/migrate_to_12.0.0"}},p={},d=[{value:"API changes",id:"api-changes",level:2},{value:"Using Storekit 2",id:"using-storekit-2",level:2},{value:"How do I know what&#39;s the minimum version of iOS my app supports?",id:"how-do-i-know-whats-the-minimum-version-of-ios-my-app-supports",level:3},{value:"How do I enable the use of Storekit 2",id:"how-do-i-enable-the-use-of-storekit-2",level:3},{value:"Buying items for user",id:"buying-items-for-user",level:3},{value:"No longer available in Sk2:",id:"no-longer-available-in-sk2",level:2},{value:"Event Listeners",id:"event-listeners",level:3},{value:"Why change the Event Listeners?",id:"why-change-the-event-listeners",level:3},{value:"getAvailableItems on Sk2",id:"getavailableitems-on-sk2",level:3}],u={toc:d},c="wrapper";function g(e){let{components:t,...n}=e;return(0,i.yg)(c,(0,a.A)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.yg)(r.A,{mdxType:"AdFitTopFixed"}),(0,i.yg)("h1",{id:"migrating-to-1100"},"Migrating to 11.0.0"),(0,i.yg)("p",null,"Version 11.0.0 is centered around implementing iOS Storekit 2."),(0,i.yg)("p",null,"I've worked hard on keeping backward compatibility. However there are things that don't translate directly to previous versions."),(0,i.yg)("h2",{id:"api-changes"},"API changes"),(0,i.yg)("p",null,"These are changes that you'd need to make even if you are not going to use Storekit 2:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("inlineCode",{parentName:"p"},"requestPurchaseWithOfferIOS")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"requestPurchaseWithQuantityIOS")," are now part of ",(0,i.yg)("inlineCode",{parentName:"p"},"requestPurchase")," by simply passing the appropriate parameters")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Methods that are exclusive to a platform, have been moved to nested objects ",(0,i.yg)("inlineCode",{parentName:"p"},"IapAndroid"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"IapAmazon"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"IapIos"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"IapIosSk2"),". So for example ",(0,i.yg)("inlineCode",{parentName:"p"},"validateReceiptAndroid")," is now available as:"))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-ts"},"import {IapAndroid} from 'react-native-iap'\n...\nIapAndroid.validateReceiptAndroid(...)\n")),(0,i.yg)("p",null,"In particular the following methods are avaiable only on Sk2 : ",(0,i.yg)("inlineCode",{parentName:"p"},"sync"),",",(0,i.yg)("inlineCode",{parentName:"p"},"isEligibleForIntroOffer"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"subscriptionStatus"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"currentEntitlement"),",",(0,i.yg)("inlineCode",{parentName:"p"},"latestTransaction")," should be called as this:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-ts"},"import {IapIosSk2} from 'react-native-iap'\n...\nIapIosSk2.isEligibleForIntroOffer(...)\n")),(0,i.yg)("p",null,"This allows for greater flexibility to use methods that are specific to a platform but the others don't offer. All the other common methods are still called in the same way as before"),(0,i.yg)("h2",{id:"using-storekit-2"},"Using Storekit 2"),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("p",{parentName:"admonition"},"Storekit 2 (Sk2) requires iOS 15 as a minimum.")),(0,i.yg)("p",null,"If your app supports only iOS 15 and above (see below how to determine that). And you want to use storekit 2 new features such as subscription groups then use ",(0,i.yg)("inlineCode",{parentName:"p"},"STOREKIT2_MODE")," during setup (see below)"),(0,i.yg)("p",null,"If your app supports older iOS versions, you'll have two options 1) ",(0,i.yg)("inlineCode",{parentName:"p"},"STOREKIT1_MODE")," will let you use the legacy code to all interactions with the library (i.e. no changes, this is the default). And 2) ",(0,i.yg)("inlineCode",{parentName:"p"},"STOREKIT_HYBRID_MODE")," Will use Sk2 on devices that support it. The library will use the old implementation (Storekit 1) as a default on devices with older versions of iOS"),(0,i.yg)("admonition",{type:"warning"},(0,i.yg)("p",{parentName:"admonition"},"Please consider the edgecases of using both (See differences below).")),(0,i.yg)("h3",{id:"how-do-i-know-whats-the-minimum-version-of-ios-my-app-supports"},"How do I know what's the minimum version of iOS my app supports?"),(0,i.yg)("p",null,"Open ",(0,i.yg)("inlineCode",{parentName:"p"},"ios/Podfile")," file\nand look for the following line:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"platform :ios, '15.0'\n")),(0,i.yg)("h3",{id:"how-do-i-enable-the-use-of-storekit-2"},"How do I enable the use of Storekit 2"),(0,i.yg)("p",null,"Call ",(0,i.yg)("inlineCode",{parentName:"p"},"setup")," before you initialize your connection as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-ts"},"import {setup} from 'react-native-iap'\n...\nsetup({storekitMode:'___Selected Mode___'})// See above for available options\nawait initConnection()\n...\n")),(0,i.yg)("h3",{id:"buying-items-for-user"},"Buying items for user"),(0,i.yg)("p",null,"When calling ",(0,i.yg)("inlineCode",{parentName:"p"},"requestPurchase"),":\nThe name of this parameter has changed to match the new API\n",(0,i.yg)("inlineCode",{parentName:"p"},"applicationUsername")," -> ",(0,i.yg)("inlineCode",{parentName:"p"},"appAccountToken")),(0,i.yg)("h2",{id:"no-longer-available-in-sk2"},"No longer available in Sk2:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Purchase promoted product. I haven't found the equivalent of promoted product purchase in the new SDK.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("inlineCode",{parentName:"p"},"transactionReceipt"),",",(0,i.yg)("inlineCode",{parentName:"p"},"purchaseToken")," are not available on ",(0,i.yg)("inlineCode",{parentName:"p"},"Purchase"),"s when using Sk")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},(0,i.yg)("inlineCode",{parentName:"p"},"currency")," is no longer available in ",(0,i.yg)("inlineCode",{parentName:"p"},"Product")," of ",(0,i.yg)("inlineCode",{parentName:"p"},"Subscription")," objects, use ",(0,i.yg)("inlineCode",{parentName:"p"},"localizedPrice")," instead"))),(0,i.yg)("h3",{id:"event-listeners"},"Event Listeners"),(0,i.yg)("p",null,"In Sk1 we have Promoted product, purchase updated and purchase error\nIn Sk2 we have Transaction Updated. Purchase updated and purchase error and only for backward compatibility and will be removed on a future iteration."),(0,i.yg)("p",null,"Note that the Transaction Updated Listener accepts ",(0,i.yg)("inlineCode",{parentName:"p"},"TransactionEvent"),"s that can be either an error or a valid transaction."),(0,i.yg)("h3",{id:"why-change-the-event-listeners"},"Why change the Event Listeners?"),(0,i.yg)("p",null,"The new native libraries allow us to move away from sending events and instead returning responses for events that are generated by user interaction. Having both models becomes hard to document so we are phasing it out and keeping only one listener for events outside the normal purchase flow.\nFor example ",(0,i.yg)("inlineCode",{parentName:"p"},"getAvaiableItems")," was both posting events and returing the list of events. That won't be the case when using Sk2, it will only return the list of Transactions. If you still want to get the events published in Sk1, use the optional parameter ",(0,i.yg)("inlineCode",{parentName:"p"},"{alsoPublishToEventListener:true}")," in ",(0,i.yg)("inlineCode",{parentName:"p"},"getAvailableItems")),(0,i.yg)("h3",{id:"getavailableitems-on-sk2"},"getAvailableItems on Sk2"),(0,i.yg)("p",null,"Another important distinction is that this method now returns the user's purchased items consistently. Meaning that the state of the transaction won't change when calling it a second time"))}g.isMDXComponent=!0}}]);